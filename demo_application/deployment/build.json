{
    "variables": {
        "vnf": null
    },
    "builders": [
        {
            "type": "openstack",
            "identity_endpoint": "http://devstack/identity/v3",
            "tenant_name": "admin",
            "domain_name": "Default",
            "username": "admin",
            "password": "password",
            "region": "RegionOne",
            "ssh_username": "ubuntu",
            "image_name": "{{user `vnf` }}",
            "source_image": "24287161-95aa-41c6-8486-e85e51d7c88c",
            "networks": "d3a88e8b-b79a-4e5e-b272-26b508f6907e",
            "security_groups": ["default"],
            "flavor": "ds512M",
            "insecure": "true"
        },
        {
            "name": "docker",
            "type": "docker",
            "image": "ubuntu:18.04",
            "commit": true,
            "changes": ["ENTRYPOINT [\"\"]"]
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "inline": [
                "mkdir /opt/{{user `vnf` }}",
                "echo 'export PATH=$PATH:/opt/{{user `vnf` }}' >> ~/.bashrc",
                "apt update",
                "apt install -y python3 python3-pip"
            ]
        },
        {
            "type": "file",
            "source": "{{user `vnf` }}/",
            "destination": "/opt/{{user `vnf` }}/"
        },
        {
            "type": "shell",
            "inline": [
                "pip3 install -r /opt/{{user `vnf` }}/{{user `vnf` }}_requirements.txt"
            ]
        }
    ],
    "post-processors": [
        {
            "type": "docker-tag",
            "repository": "{{user `vnf` }}",
            "tag": "latest",
            "only": [
                "docker"
            ]
        }
    ]
}